<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Executive Orders Timeline by President</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: Arial; margin: 40px; }
    #timeline { width: 100%; height: 1000px; }
  </style>
</head>
<body>
  <h2>Executive Orders Timeline Explorer (Faceted by President)</h2>
  <div id="timeline"></div>

  <script>
    function getPresident(dateStr) {
      const date = new Date(dateStr);
      const presidents = [
        { name: "President 47: Donald Trump", start: "2025-01-20", party: "Republican" }, 
        { name: "President 46: Joe Biden", start: "2021-01-20", party: "Democrat" },
        { name: "President 45: Donald Trump", start: "2017-01-20", party: "Republican" },
        { name: "President 44: Barack Obama", start: "2009-01-20", party: "Democrat" },
        { name: "President 43: George W. Bush", start: "2001-01-20", party: "Republican" },
        { name: "President 42: Bill Clinton", start: "1993-01-20", party: "Democrat" },
        { name: "President 41: George H. W. Bush", start: "1989-01-20", party: "Republican" },
        { name: "President 40: Ronald Reagan", start: "1981-01-20", party: "Republican" }
      ];
      for (let i = 0; i < presidents.length; i++) {
        const start = new Date(presidents[i].start);
        const end = i === 0 ? new Date() : new Date(presidents[i - 1].start);
        if (date >= start && date < end) {
          return presidents[i];
        }
      }
      return { name: "Unknown", party: "Unknown" };
    }

    const partyColors = {
      Democrat: 'rgb(0, 102, 204)',
      Republican: 'rgb(204, 0, 0)',
      Unknown: 'gray'
    };

    d3.csv("./executive_orders.csv").then(function(data) {
      const grouped = {};

      data.forEach(d => {
        const parseDate = d3.timeParse("%m/%d/%Y");
        const dateObj = parseDate(d.signing_date.trim());
        const date = dateObj ? dateObj.toISOString().split("T")[0] : null;
        if (!date) return;

        const title = d.title;
        const url = d.html_url || d.pdf_url || "";

        const presidentObj = getPresident(date);
        const president = presidentObj.name;
        const party = presidentObj.party;

        if (!grouped[president]) grouped[president] = {
          dates: [], texts: [], urls: [], party
        };

        grouped[president].dates.push(date);
        grouped[president].texts.push(`${d.executive_order_number ? "EO " + d.executive_order_number + ": " : ""}${title}`);
        grouped[president].urls.push(url);
      });

      const presidents = Object.keys(grouped);
      const traces = [];
      const annotations = [];

      presidents.forEach((president, index) => {
        const row = index + 1;

        traces.push({
          x: grouped[president].dates,
          y: Array(grouped[president].dates.length).fill(president),
          text: grouped[president].texts,
          customdata: grouped[president].urls,
          type: 'scatter',
          mode: 'markers',
          marker: {
            color: partyColors[grouped[president].party],
            size: 10,
            line: { width: 2, color: 'black' }
          },
          xaxis: 'x',
          yaxis: 'y' + row,
          name: president,
          showlegend: false
        });

        // Annotation
        const maxDate = new Date(Math.max(...grouped[president].dates.map(d => new Date(d))));
        annotations.push({
          x: maxDate.toISOString().split("T")[0],
          y: president,
          text: `ðŸ“ ${grouped[president].dates.length} orders`,
          xref: 'x',
          yref: 'y' + row,
          showarrow: true,
          arrowhead: 4,
          ax: 40,
          ay: -20,
          font: { size: 12, color: 'black' },
          bgcolor: 'rgba(255,255,255,0.7)',
          bordercolor: 'gray',
          borderwidth: 1
        });
      });

      const layout = {
        title: 'Executive Orders Timeline by President',
        grid: { rows: presidents.length, columns: 1, pattern: 'independent' },
        height: presidents.length * 150,
        hovermode: 'closest',
        annotations: annotations,
        xaxis: { title: 'Date', type: 'date' }
      };

      presidents.forEach((president, i) => {
        layout['yaxis' + (i + 1)] = {
          title: president,
          automargin: true
        };
      });

      Plotly.newPlot('timeline', traces, layout);

      const plotDiv = document.getElementById('timeline');
      plotDiv.on('plotly_click', function(data){
        const url = data.points[0].customdata;
        if (url) window.open(url, '_blank');
      });
    });
  </script>
</body>
</html>
